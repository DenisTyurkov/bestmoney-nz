{% comment %}
  Insurance Card Component
  Usage: {% include components/insurance-card.html provider=provider rank=1 show_rank=true %}
{% endcomment %}

{% assign p = include.provider %}
{% assign cta_url = p.affiliate_url %}
{% if cta_url == nil or cta_url == '' or cta_url == '#' %}
  {% assign cta_url = p.website %}
{% endif %}
{% assign available_coverages = '' %}
{% if p.coverage_types %}
  {% assign available_coverages = p.coverage_types | where: "available", true | map: "type" | join: "," %}
{% endif %}

<div class="lender-card {% if p.is_top_pick %}lender-card--highlight{% endif %}"
     data-provider-id="{{ p.id }}"
     data-coverage-types="{{ available_coverages }}"
     data-price-range="{{ p.price_range }}">

  <!-- Rank Badge -->
  {% if include.show_rank %}
  <div class="lender-rank">
    <span class="rank-number">{{ include.rank }}</span>
  </div>
  {% endif %}

  <!-- Promotional Badges -->
  {% if p.badges.size > 0 %}
  <div class="lender-badges">
    {% for badge in p.badges limit:2 %}
      <span class="badge badge--{{ badge.type }}">{{ badge.label }}</span>
    {% endfor %}
  </div>
  {% endif %}

  <div class="lender-card-content">
    <!-- Left Section: Logo & Basic Info -->
    <div class="lender-left">
      {% if p.logo %}
      <img src="{{ p.logo }}" alt="{{ p.name }} logo" class="lender-logo" loading="lazy">
      {% else %}
      <div class="lender-logo-placeholder" style="width: 100px; height: 40px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666;">{{ p.name | truncate: 10 }}</div>
      {% endif %}
      <h3 class="lender-name">{{ p.name }}</h3>
    </div>

    <!-- Middle Section: Features & Details -->
    <div class="lender-middle">
      <ul class="lender-features">
        {% for feature in p.features limit:3 %}
          <li>
            <svg class="icon-check" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            {{ feature }}
          </li>
        {% endfor %}
      </ul>

      {% if p.bottom_line %}
      <p class="lender-bottom-line">{{ p.bottom_line }}</p>
      {% endif %}

      <!-- Coverage Types -->
      {% if p.coverage_types %}
      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
        {% for coverage in p.coverage_types %}
          {% if coverage.available %}
          <span style="font-size: 0.75rem; background: #E8FAF4; color: #225447; padding: 0.25rem 0.5rem; border-radius: 4px;">{{ coverage.type | replace: '-', ' ' | capitalize }}</span>
          {% endif %}
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Right Section: Score & CTA -->
    <div class="lender-right">
      <!-- BestMoney Score -->
      {% if p.bestmoney_score %}
      <div class="rating-badge {% if p.bestmoney_score >= 9 %}rating-badge--excellent{% elsif p.bestmoney_score >= 8 %}rating-badge--very-good{% else %}rating-badge--good{% endif %}">
        <span class="rating-score">{{ p.bestmoney_score }}</span>
        <span class="rating-label">BestMoney Score</span>
        <div class="rating-bar">
          <div class="rating-bar-fill" style="width: {{ p.bestmoney_score | times: 10 }}%"></div>
        </div>
      </div>
      {% endif %}

      <!-- Social Proof -->
      {% if p.weekly_visitors %}
      <div class="social-proof">
        <svg class="icon-users" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <span><strong>{{ p.weekly_visitors }}</strong> visited</span>
      </div>
      {% endif %}

      <!-- Key Stats -->
      <div class="lender-stats">
        {% if p.claims_rating %}
        <div class="stat">
          <span class="stat-label">Claims</span>
          <span class="stat-value">{{ p.claims_rating }}/5</span>
        </div>
        {% endif %}
        {% if p.price_range %}
        <div class="stat">
          <span class="stat-label">Price</span>
          <span class="stat-value">{{ p.price_range }}</span>
        </div>
        {% endif %}
      </div>

      <!-- CTA Button -->
      <a href="{{ cta_url }}"
         class="btn btn-cta"
         data-track-click="{{ p.id }}"
         target="_blank"
         rel="noopener sponsored">
        Get Quote
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="16" height="16">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
        </svg>
      </a>
    </div>
  </div>
</div>
